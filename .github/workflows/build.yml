# Validation du projet Open Road
# Ce workflow s'execute sur chaque push et pull request
# Note: Le build complet necessite AutoCAD (DLL proprietaires)
#       Ce workflow valide uniquement la structure du projet

name: Build

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout du code
      uses: actions/checkout@v4

    - name: Verifier la structure du projet
      run: |
        echo "=== Validation de la structure Open Asphalte ==="

        # Verifier les fichiers essentiels
        files=("README.md" "LICENSE" "CHANGELOG.md" "version.json")
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "✓ $file present"
          else
            echo "✗ $file MANQUANT" && exit 1
          fi
        done

        # Verifier le Core compile
        if [ -f "bin/OAS.Core.dll" ]; then
          echo "✓ bin/OAS.Core.dll present"
        else
          echo "✗ bin/OAS.Core.dll MANQUANT - Compilez localement avant de push" && exit 1
        fi

        # Verifier la structure des sources
        if [ -d "src/OAS.Core" ]; then
          echo "✓ Sources Core presentes"
        else
          echo "✗ Sources Core manquantes" && exit 1
        fi

        echo ""
        echo "=== Validation reussie ==="
      shell: bash

    - name: Lister les modules disponibles
      run: |
        echo "=== Modules compiles disponibles ==="
        if [ -d "bin/Modules" ]; then
          ls -la bin/Modules/*.dll 2>/dev/null || echo "Aucun module compile"
        fi
      shell: bash

    - name: Afficher la version
      run: |
        echo "=== Version du projet ==="
        cat version.json
      shell: bash
